# ============================================================
#  NEXUS — Prometheus Konfiguracja
#  Zbiera metryki ze wszystkich serwisów platformy
# ============================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    platforma: nexus
    srodowisko: docker

# ─── Alerting ────────────────────────────────────────────────
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# ─── Reguły alertów ─────────────────────────────────────────
rule_files: []

# ─── Zbieranie metryk ────────────────────────────────────────
scrape_configs:
  # Prometheus samo-monitorowanie
  - job_name: prometheus
    static_configs:
      - targets: [localhost:9090]

  # Backend FastAPI (metryki OpenTelemetry)
  - job_name: nexus-backend
    static_configs:
      - targets: [backend:8000]
    metrics_path: /metrics
    scrape_interval: 10s

  # Celery Worker (via Flower)
  - job_name: nexus-celery
    static_configs:
      - targets: [flower:5555]
    metrics_path: /metrics
    scrape_interval: 15s

  # Redis (via redis_exporter)
  - job_name: redis
    static_configs:
      - targets: [redis:6379]
    scrape_interval: 30s

  # PostgreSQL
  - job_name: postgres
    static_configs:
      - targets: [postgres:5432]
    scrape_interval: 30s

  # Nginx
  - job_name: nginx
    static_configs:
      - targets: [nginx:80]
    metrics_path: /nginx-health
    scrape_interval: 30s

  # Node (host metryki przez Docker)
  - job_name: docker
    static_configs:
      - targets: [host.docker.internal:9323]
    scrape_interval: 30s

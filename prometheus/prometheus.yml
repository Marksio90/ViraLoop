# ============================================================
#  NEXUS — Prometheus Konfiguracja
#  Zbiera metryki ze wszystkich serwisów platformy
# ============================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    platforma: nexus
    srodowisko: docker

# ─── Alerting ────────────────────────────────────────────────
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# ─── Reguły alertów ─────────────────────────────────────────
rule_files: []

# ─── Zbieranie metryk ────────────────────────────────────────
scrape_configs:
  # Prometheus samo-monitorowanie
  - job_name: prometheus
    static_configs:
      - targets: [localhost:9090]

  # Backend FastAPI (metryki OpenTelemetry)
  - job_name: nexus-backend
    static_configs:
      - targets: [backend:8000]
    metrics_path: /metrics
    scrape_interval: 10s

  # Celery Worker (via Flower — eksponuje /metrics w formacie Prometheus)
  - job_name: nexus-celery
    static_configs:
      - targets: [flower:5555]
    metrics_path: /metrics
    scrape_interval: 15s

  # Redis, PostgreSQL, Nginx — wymagają dedykowanych eksporterów
  # (redis_exporter, postgres_exporter, nginx-prometheus-exporter).
  # Bezpośrednie scrapowanie portów bazy danych (6379, 5432) przez HTTP
  # powoduje błędy protokołu i alarmy bezpieczeństwa Redis.
  # Dodaj eksportery do docker-compose.yml aby odblokować te metryki.
